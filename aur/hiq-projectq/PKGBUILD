# Maintainer: Damien Nguyen <damien1@huawei.com>

pkgbase=python-hiq-projectq
_name=${pkgbase#python-}
pkgname=('python3-hiq-projectq' 'python-hiq-projectq')

pkgver=0.6.4.post2
pkgrel=1
pkgdesc="ProjectQ - An open source software framework for quantum computing"
url="https://hiq.huaweicloud.com/en/"
depends=('python'
         'python-matplotlib'
         'python-networkx'
         'python-numpy'
         'python-pytest'
         'python-requests'
         'python-scipy'
         'python-sympy')
makedepends=('pybind11' 'python' 'python-setuptools')
checkdepends=('python'
              'python-matplotlib'
              'python-networkx'
              'python-numpy'
              'python-pytest'
              'python-requests'
              'python-scipy'
              'python-sympy')
license=('Apache 2')
arch=('i686' 'x86_64')
source=("https://files.pythonhosted.org/packages/source/${_name::1}/$_name/$_name-$pkgver.tar.gz")
sha256sums=('f404e530cea8a1741062626ca7ebe23e9a3bde1198cd0bf602fde0fe2c9359fe')
groups=(python-hiq)

prepare() {
  cd "$srcdir/$_name-$pkgver"
  # patch -p1 -i "$srcdir/$pkgname-$pkgver.patch"
}

build() {
  cd "$srcdir/$_name-$pkgver"
  python setup.py build
}

check() {
  cd "$srcdir/$_name-$pkgver"
  python setup.py build_ext --inplace

  # Make sure there is always at least one test to be found by pytest
  cat << EOF > projectq/aur_test.py
def test_dummy():
    pass
EOF

  python -m pytest -p no:warnings
  rm -v projectq/aur_test.py
}

package_python3-hiq-projectq() {
  cd "$srcdir/$_name-$pkgver"
  python setup.py install --root="$pkgdir" --optimize=1
}

package_python-hiq-projectq() {
  cd "$srcdir/$_name-$pkgver"
  python setup.py install --root="$pkgdir" --optimize=1
}

# vim:set ts=2 sw=2 et:
